# Rustにおけるコードカバレッジの取得

## 環境

### 拡張機能

- `Coverage Gutters`

### 設定

#### .vscode/settings.json

```json
{
    "coverage-gutters.showGutterCoverage": true,
    "coverage-gutters.lcovname": "coverage/lcov.info",
    "coverage-gutters.coverageReportFileNames": [
        "coverage/lcov.info",
        "coverage/cobertura.xml",
        "coverage/jacoco.xml"
    ],
    "coverage-gutters.enableCoverageCodeLens": true,
    "coverage-gutters.showLineCoverage": true
}
```

#### .vscode/tasks.json

```json
{
    "version": "2.0.0",
    "tasks": [
{
            "label": "coverage:rust",
            "type": "shell",
            "command": "cargo llvm-cov --workspace --lcov --output-path coverage/lcov.info",
            "problemMatcher": []
        }, {
            "label": "coverage:ts",
            "type": "shell",
            "command": "vitest run --coverage --reporter=junit && mkdir -p coverage && test -f coverage/lcov.info || true",
            "problemMatcher": []
        }, {
            "label": "coverage:python",
            "type": "shell",
            "command": "pytest --cov=. --cov-report=lcov:coverage/lcov.info --cov-report=xml:coverage/cobertura.xml",
            "problemMatcher": []
        }, {
            "label": "coverage:go",
            "type": "shell",
            "command": "go test ./... -coverprofile=coverage/cover.out && go tool cover -html=coverage/cover.out -o coverage/index.html",
            "problemMatcher": []
        }
    ]
}
```

### 各言語における設定と実行

#### Rust

- `cargo llvm-cov` のインストール

```bash
cargo install cargo-llvm-cov
rustup component add llvm-tools-preview
```

- 実行例

```bash
# 最もシンプルな実行
cargo llvm-cov
# LCOVの生成
cargo llvm-cov --workspace --lcov --output-path rust/v1/coverage/lcov.info
# HTMLレポートの生成とブラウザでの表示
cargo llvm-cov --workspace --html --output-dir rust/v1/coverage/ --open
```

- 説明
- `--workspace` : ワークスペース全体を対象にする
- `--lcov` : LCOV形式で出力する
- `--output-path` : 出力ファイルのパスを指定する
- `--html` : HTML形式で出力する
- `--output-dir` : HTML出力ディレクトリを指定する
- `--open` : 出力後にブラウザで表示する

```toml
[profile.dev]
debug = true
```

- エディタ上で色分けして表示
ステータスバーの `Coverage Gutters: No Coverage` をクリックし、`Watch` を選択
